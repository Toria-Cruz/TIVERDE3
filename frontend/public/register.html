<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastrar Usu치rio - EcoTech</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #f7fefb;
        }

        .register-form {
            max-width: 400px;
            width: 100%;
        }
    </style>
</head>

<body class="d-flex justify-content-center align-items-center vh-100">

    <div class="register-form">
        <form class="p-4 bg-white rounded shadow">
            <h3 class="text-success text-center mb-4">Criar Conta</h3>

            <input type="text" name="username" class="form-control mb-3" placeholder="Usu치rio" required>
            <input type="password" name="password" class="form-control mb-3" placeholder="Senha" required>

            <button type="submit" class="btn btn-success w-100">Cadastrar</button>
            <a href="login.html" class="btn btn-outline-success w-100 mt-3">J치 tenho conta</a>
        </form>

        <script>
            document.querySelector("form").addEventListener("submit", async function (e) {
                e.preventDefault(); // impede recarregar a p치gina

                const form = e.target;
                const formData = new FormData(form);

                const data = {
                    username: formData.get("username"),
                    password: formData.get("password")
                };

                try {
                    const response = await fetch("http://localhost:5000/register", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (result.id) {
                        // 游댠 SALVA O LOGIN AUTOMATICAMENTE
                        sessionStorage.setItem("usuarioLogado", JSON.stringify({
                            id: result.id,
                            username: data.username
                        }));

                        // 游댠 REDIRECIONA PARA A HOME
                        window.location.href = "/index.html";
                    } else {
                        alert("Erro: " + (result.error || "Erro inesperado"));
                    }
                } catch (err) {
                    console.error("Erro:", err);
                    alert("N칚o foi poss칤vel cadastrar");
                }
            });
        </script>

</body>

</html>